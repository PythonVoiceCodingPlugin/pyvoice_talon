# pyvoice_talon


This is the sublime portion of [pyvoice](https://github.com/PythonVoiceCodingPlugin)


<div>
<img src="https://raw.githubusercontent.com/PythonVoiceCodingPlugin/assets/main/pyvoice_logo.png" align="right" height=320 width=320/>
</div>
<!-- MarkdownTOC  autolink="true" -->

- [Installation](#installation)
	- [Requirements](#requirements)
	- [Download Grammar Files](#download-grammar-files)
- [Interprocess Communication: Troubleshooting and Security Considerations](#interprocess-communication-troubleshooting-and-security-considerations)
	- [Receiving speech hints](#receiving-speech-hints)
	- [Sending commands](#sending-commands)
		- [Sublime Text](#sublime-text)
		- [Vscode client](#vscode-client)
- [License](#license)

<!-- /MarkdownTOC -->


# Installation

## Requirements

- make sure you have talon installed. If not see [installation instructions](https://talonvoice.com/docs/)

- if you want to use [vscode](https://marketplace.visualstudio.com/items?itemName=mpourmpoulis.pyvoice) you also need to download [community](https://github.com/talonhub/community)

## Download Grammar Files

Simply clone this repo into your talon user directory

```bash
cd ~/.talon/user

or on windows

cd ~\AppData\Roaming\talon\user
```

```bash
git clone https://github.com/PythonVoiceCodingPlugin/pyvoice_talon.git
```

and reboot talon

# Interprocess Communication: Troubleshooting and Security Considerations

## Receiving speech hints

In order to transmit speech hints to the programming by voice system, an interprocess communication mechanism is employed utilizing `AF_UNIX` sockets on UNIX systems and `AF_PIPE` named pipes on Windows as transports with the format   being JSON-RPC 2.0. This talon grammar is going to bind that socket or pipe as a listener/server and sublime/vscode are going to connects as a clients.


> [!IMPORTANT]
> Implementation wise, the t grammar is going to utilize the stdlib `multiprocessing.connection` machinery, it works cross-platform and cross python versions. Two important security-related notes
> - On Windows name pipe is created with the default security descriptors (per the stdlib). That means that nonprivileged users on that machine should be able to connect to the server launched by the grammar as readers (though given the one-way direction of the rpc mechanism, there should not be much to read anyhow) but they should not be able to write back to it(and execute commands). 
> - there exists a race condition where processes running with lower privileges may try to bind the named pipe on windows before our grammar does cuasing the editors to talk to them instead. In order to avoid the scenario, we utilize a mechanism of stdlib implementation   for authenticating both ends of the connection via cryptographic challenge based on a shared key. 
> The shared key is generated by the voice system and is persisted in json file in the user's home directory, which should be out of reach for those low privilege user processes. 


> [!WARNING]
> Unfortunately, the auth handshake employed by the stdlib is using HMAC-MD5. It is only python 3.12 that introduced support for stronger hash functions , while also extending the handshake protocol in a backwards compatible manner. While not the end of the world, at some point,I would have to back port the improved version

> [!NOTE]
> at the moment you cannot have multiple t/talon grammars instances listening simultaneously

## Sending commands


### Sublime Text


Executing commands for sublime text is preformed via its commandline interface `subl` which may NOT always be in system path on all platforms by default.

The t client will search through various directories based on your operating system in order to find its location. If this procedure fails, an error should appear in the logs. In that case please see the official sublime documentation for more information and submit an issue

https://www.sublimetext.com/docs/command_line.html


### Vscode client

commands are transmitted to vscode with file based RPC, with the [Command Server Extension](https://marketplace.visualstudio.com/items?itemName=pokey.command-server) acting as a receiver on the other end.

This grammar relies on the client shipped with [community](https://github.com/talonhub/community) via 

```python
actions.user.vscode_with_plugin
```





# License

This project is licensed under the GPL v3 License - excluding the following bits

- `deps.zip` which packages for ease of installation the [`jsonrpc`](https://github.com/pavlov99/json-rpc/tree/master/jsonrpc) library  and is  licensed under  MIT






